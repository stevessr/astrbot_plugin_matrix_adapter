{
  "matrix_oauth2_callback_port": {
    "description": "OAuth2 回调服务器端口",
    "type": "int",
    "hint": "OAuth2 认证回调服务器监听端口，用于接收认证重定向",
    "default": 8765
  },
  "matrix_oauth2_callback_host": {
    "description": "OAuth2 回调服务器主机地址",
    "type": "string",
    "hint": "OAuth2 认证回调服务器监听主机地址，默认 127.0.0.1 仅限本地访问，0.0.0.0 允许所有地址访问（适用于远程服务器部署）",
    "default": "127.0.0.1"
  },
  "matrix_media_cache_gc_days": {
    "description": "媒体缓存清理天数",
    "type": "int",
    "hint": "清理超过指定天数未使用的媒体缓存，<=0 表示禁用",
    "default": 30
  },
  "matrix_media_download_concurrency": {
    "description": "媒体下载并发上限",
    "type": "int",
    "hint": "每个媒体源 server 的并发下载上限，最小为 1",
    "default": 4
  },
  "matrix_media_download_min_interval_ms": {
    "description": "媒体下载最小间隔（毫秒）",
    "type": "int",
    "hint": "同一媒体源 server 两次下载请求之间的最小间隔，<=0 表示不限制",
    "default": 0
  },
  "matrix_media_download_breaker_fail_threshold": {
    "description": "媒体下载熔断失败阈值",
    "type": "int",
    "hint": "按媒体源 server 统计的连续失败次数阈值，达到后进入熔断冷却（<=0 表示禁用）",
    "default": 6
  },
  "matrix_media_download_breaker_cooldown_ms": {
    "description": "媒体下载熔断基础冷却（毫秒）",
    "type": "int",
    "hint": "首次熔断的冷却时长；连续失败会指数退避增长",
    "default": 5000
  },
  "matrix_media_download_breaker_max_cooldown_ms": {
    "description": "媒体下载熔断最大冷却（毫秒）",
    "type": "int",
    "hint": "熔断冷却时长上限",
    "default": 120000
  },
  "matrix_media_cache_index_persist": {
    "description": "持久化媒体缓存索引",
    "type": "bool",
    "hint": "启用后使用 SQLite 持久化缓存索引，重启后仍可快速命中本地媒体缓存",
    "default": true
  },
  "matrix_media_auto_download_max_bytes": {
    "description": "媒体自动下载大小上限（字节）",
    "type": "int",
    "hint": "当收到媒体消息时，超过该大小将跳过自动下载并尽量保留 URL（<=0 表示不限制）",
    "default": 0
  },
  "matrix_media_auto_download_image": {
    "description": "自动下载图片",
    "type": "bool",
    "hint": "是否自动下载 Matrix 图片消息（m.image）",
    "default": true
  },
  "matrix_media_auto_download_video": {
    "description": "自动下载视频",
    "type": "bool",
    "hint": "是否自动下载 Matrix 视频消息（m.video）",
    "default": true
  },
  "matrix_media_auto_download_audio": {
    "description": "自动下载语音",
    "type": "bool",
    "hint": "是否自动下载 Matrix 音频消息（m.audio）",
    "default": true
  },
  "matrix_media_auto_download_file": {
    "description": "自动下载文件",
    "type": "bool",
    "hint": "是否自动下载 Matrix 文件消息（m.file）",
    "default": true
  },
  "matrix_media_auto_download_sticker": {
    "description": "自动下载贴纸",
    "type": "bool",
    "hint": "是否自动下载 Matrix 贴纸消息（m.sticker）",
    "default": true
  },
  "matrix_media_upload_strict_mime_check": {
    "description": "上传时严格 MIME 校验",
    "type": "bool",
    "hint": "上传媒体前检查声明 MIME、扩展名与文件头嗅探结果是否一致",
    "default": true
  },
  "matrix_media_upload_blocked_extensions": {
    "description": "上传扩展名黑名单",
    "type": "list",
    "hint": "例如 ['.exe','.dll','.bat','.cmd','.sh','.ps1','.jar','.msi','.scr','.com']",
    "default": [".exe", ".dll", ".bat", ".cmd", ".sh", ".ps1", ".jar", ".msi", ".scr", ".com"]
  },
  "matrix_media_upload_allowed_mime_rules": {
    "description": "上传允许的 MIME 规则",
    "type": "list",
    "hint": "支持 image/* 等通配符，例如 ['image/*','video/*','audio/*','text/*','application/pdf','application/json','application/zip','application/octet-stream']",
    "default": ["image/*", "video/*", "audio/*", "text/*", "application/pdf", "application/json", "application/zip", "application/octet-stream"]
  },
  "matrix_sticker_auto_sync": {
    "description": "自动同步 Sticker 包",
    "type": "bool",
    "hint": "是否自动同步房间的 Sticker 包（im.ponies.room_emotes），启用后会在加入房间时自动下载房间的自定义贴纸",
    "default": false
  },
  "matrix_sticker_sync_user_emotes": {
    "description": "同步用户 Sticker",
    "type": "bool",
    "hint": "是否同步用户级别的 Sticker 包（im.ponies.user_emotes）",
    "default": false
  },
  "matrix_force_message_type": {
    "description": "强制消息类型",
    "type": "string",
    "hint": "强制消息类型：auto（自动判断群聊/私聊）、private（全部私聊）、group（全部群聊）、stalk（写入对话并按群存档 JSONL）",
    "options": ["auto", "private", "group", "stalk"],
    "default": "auto"
  },
  "matrix_emoji_shortcodes": {
    "description": "启用 Emoji 短码转换",
    "type": "bool",
    "hint": "启用后自动将 :smile:、:thumbsup: 等短码转换为 Emoji",
    "default": false
  },
  "matrix_data_storage_backend": {
    "description": "数据存储后端",
    "type": "string",
    "hint": "数据存储后端（users/rooms/auth/sync/device_info + E2EE 本地状态）：json / sqlite / pgsql",
    "options": ["json", "sqlite", "pgsql"],
    "default": "json"
  },
  "matrix_pgsql": {
    "description": "PostgreSQL 配置",
    "type": "object",
    "condition": { "matrix_data_storage_backend": "pgsql" },
    "items": {
      "dsn": {
        "description": "PostgreSQL DSN",
        "type": "string",
        "hint": "例如 postgresql://user:pass@127.0.0.1:5432/dbname",
        "default": ""
      },
      "schema": {
        "description": "PostgreSQL Schema",
        "type": "string",
        "hint": "pgsql 后端使用的 schema，默认 public",
        "default": "public"
      },
      "table_prefix": {
        "description": "PostgreSQL 表名前缀",
        "type": "string",
        "hint": "pgsql 后端生成表名时使用的前缀，默认 matrix_store",
        "default": "matrix_store"
      }
    }
  }
}
